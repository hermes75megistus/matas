<?php
// Aktif katsayƒ±larƒ± al
global $wpdb;
$katsayilar = $wpdb->get_row("SELECT * FROM {$wpdb->prefix}matas_katsayilar WHERE aktif = 1 ORDER BY id DESC LIMIT 1", ARRAY_A);
$donem = $katsayilar ? $katsayilar['donem'] : 'Ge√ßerli D√∂nem';
?>

<div class="matas-container">
    <header>
        <h1><?php echo esc_html($atts['baslik']); ?> (<?php echo esc_html($donem); ?>)</h1>
        <div class="last-update">Son G√ºncelleme: <?php echo date('d F Y'); ?></div>
    </header>
    
    <div class="matas-tabs">
        <div class="matas-tab active" data-tab="hesaplama">
            <span class="tab-icon">üìä</span>Maa≈ü Hesaplama
        </div>
        <div class="matas-tab" data-tab="yedekleme">
            <span class="tab-icon">üíæ</span>Yedekleme/Geri Y√ºkleme
        </div>
        <div class="matas-tab" data-tab="bilgi">
            <span class="tab-icon">‚ÑπÔ∏è</span>Bilgilendirme
        </div>
    </div>
    
    <!-- Hesaplama Sekmesi -->
    <div id="matas-hesaplama" class="matas-tab-content active">
        <form id="matas-hesaplama-form">
            <!-- Genel Bilgiler B√∂l√ºm√º -->
            <div class="matas-form-section">
                <div class="matas-form-section-header">
                    <span>Genel Bilgiler</span>
                    <button type="button" class="matas-form-section-toggle">-</button>
                </div>
                <div class="matas-form-section-content">
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label for="unvan" class="required">√únvan:</label>
                            <select id="unvan" name="unvan" class="matas-form-control" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <?php
                                $unvanlar = $wpdb->get_results("SELECT * FROM {$wpdb->prefix}matas_unvan_bilgileri ORDER BY unvan_adi ASC", ARRAY_A);
                                $unvan_gruplari = array();
                                
                                // √únvanlarƒ± gruplara ayƒ±r
                                foreach ($unvanlar as $unvan) {
                                    $grup = explode('_', $unvan['unvan_kodu'])[0];
                                    $grup = ucfirst($grup);
                                    
                                    if (!isset($unvan_gruplari[$grup])) {
                                        $unvan_gruplari[$grup] = array();
                                    }
                                    
                                    $unvan_gruplari[$grup][] = $unvan;
                                }
                                
                                // Gruplarƒ± ve √ºnvanlarƒ± listele
                                foreach ($unvan_gruplari as $grup => $grup_unvanlar) {
                                    echo '<optgroup label="' . esc_attr($grup) . '">';
                                    
                                    foreach ($grup_unvanlar as $unvan) {
                                        echo '<option value="' . esc_attr($unvan['unvan_kodu']) . '" data-ekgosterge="' . esc_attr($unvan['ekgosterge']) . '" data-ozelhizmet="' . esc_attr($unvan['ozel_hizmet']) . '" data-yanodeme="' . esc_attr($unvan['yan_odeme']) . '" data-isguclugu="' . esc_attr($unvan['is_guclugu']) . '">' . esc_html($unvan['unvan_adi']) . '</option>';
                                    }
                                    
                                    echo '</optgroup>';
                                }
                                ?>
                            </select>
                            <span class="matas-tooltip" data-tip="√áalƒ±≈ütƒ±ƒüƒ±nƒ±z kurumda sahip olduƒüunuz √ºnvanƒ± se√ßiniz.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label for="derece" class="required">Derece:</label>
                            <select id="derece" name="derece" class="matas-form-control" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <?php for ($i = 1; $i <= 15; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?>. Derece</option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="Maa≈ü bordronuzda yazan derece bilgisini se√ßiniz. Eƒüer bilmiyorsanƒ±z √∂zl√ºk biriminizden √∂ƒürenebilirsiniz.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label for="kademe" class="required">Kademe:</label>
                            <select id="kademe" name="kademe" class="matas-form-control" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <?php for ($i = 1; $i <= 9; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?>. Kademe</option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="Maa≈ü bordronuzda yazan kademe bilgisini se√ßiniz. Her derecede 1'den 9'a kadar kademe bulunur.">?</span>
                        </div>
                    </div>
                    
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label for="hizmet_yili" class="required">Hizmet Yƒ±lƒ±:</label>
                            <select id="hizmet_yili" name="hizmet_yili" class="matas-form-control" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <?php for ($i = 0; $i <= 40; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?> Yƒ±l</option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="Devlet memurluƒüunda ge√ßirdiƒüiniz toplam hizmet s√ºresini se√ßiniz.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label for="medeni_hal">Medeni Hal:</label>
                            <select id="medeni_hal" name="medeni_hal" class="matas-form-control">
                                <option value="evli">Evli</option>
                                <option value="bekar">Bekar</option>
                            </select>
                            <span class="matas-tooltip" data-tip="Aile yardƒ±mƒ± hesaplamasƒ± i√ßin medeni halinizi se√ßiniz.">?</span>
                        </div>
                        
                        <div class="matas-form-group" id="es_durum_group">
                            <label for="es_calisiyor">E≈ü √áalƒ±≈üma Durumu:</label>
                            <select id="es_calisiyor" name="es_calisiyor" class="matas-form-control">
                                <option value="hayir">√áalƒ±≈ümƒ±yor</option>
                                <option value="evet">√áalƒ±≈üƒ±yor</option>
                            </select>
                            <span class="matas-tooltip" data-tip="E≈üinizin √ßalƒ±≈üma durumunu se√ßiniz. E≈üiniz √ßalƒ±≈ümƒ±yorsa aile yardƒ±mƒ± alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- √áocuk Bilgileri B√∂l√ºm√º -->
            <div class="matas-form-section">
                <div class="matas-form-section-header">
                    <span>√áocuk Bilgileri</span>
                    <button type="button" class="matas-form-section-toggle">-</button>
                </div>
                <div class="matas-form-section-content">
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label for="cocuk_sayisi">Toplam √áocuk Sayƒ±sƒ±:</label>
                            <select id="cocuk_sayisi" name="cocuk_sayisi" class="matas-form-control">
                                <option value="0">0</option>
                                <?php for ($i = 1; $i <= 10; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="√áocuk yardƒ±mƒ± hesaplamasƒ± i√ßin toplam √ßocuk sayƒ±nƒ±zƒ± se√ßiniz.">?</span>
                        </div>
                        
                        <div class="matas-form-group" id="cocuk_06_group" style="display:none;">
                            <label for="cocuk_06">0-6 Ya≈ü Arasƒ± √áocuk:</label>
                            <select id="cocuk_06" name="cocuk_06" class="matas-form-control">
                                <option value="0">0</option>
                                <?php for ($i = 1; $i <= 10; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="0-6 ya≈ü arasƒ± √ßocuklarƒ±nƒ±z i√ßin daha y√ºksek √ßocuk yardƒ±mƒ± alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                        
                        <div class="matas-form-group" id="engelli_cocuk_group" style="display:none;">
                            <label for="engelli_cocuk">Engelli √áocuk:</label>
                            <select id="engelli_cocuk" name="engelli_cocuk" class="matas-form-control">
                                <option value="0">0</option>
                                <?php for ($i = 1; $i <= 10; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="Engelli √ßocuklarƒ±nƒ±z i√ßin daha y√ºksek √ßocuk yardƒ±mƒ± alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                        
                        <div class="matas-form-group" id="ogrenim_cocuk_group" style="display:none;">
                            <label for="ogrenim_cocuk">√ñƒürenim G√∂ren √áocuk:</label>
                            <select id="ogrenim_cocuk" name="ogrenim_cocuk" class="matas-form-control">
                                <option value="0">0</option>
                                <?php for ($i = 1; $i <= 10; $i++) : ?>
                                    <option value="<?php echo $i; ?>"><?php echo $i; ?></option>
                                <?php endfor; ?>
                            </select>
                            <span class="matas-tooltip" data-tip="√ñƒürenim g√∂ren √ßocuklarƒ±nƒ±z i√ßin daha y√ºksek √ßocuk yardƒ±mƒ± alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Eƒüitim ve Dil Bilgileri B√∂l√ºm√º -->
            <div class="matas-form-section">
                <div class="matas-form-section-header">
                    <span>Eƒüitim ve Dil Bilgileri</span>
                    <button type="button" class="matas-form-section-toggle">-</button>
                </div>
                <div class="matas-form-section-content">
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label for="egitim_durumu">Eƒüitim Durumu:</label>
                            <select id="egitim_durumu" name="egitim_durumu" class="matas-form-control">
                                <option value="lisans">Lisans</option>
                                <option value="yuksek_lisans">Y√ºksek Lisans</option>
                                <option value="doktora">Doktora</option>
                            </select>
                            <span class="matas-tooltip" data-tip="Y√ºksek lisans veya doktora mezunlarƒ± ek tazminat alƒ±rlar.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label for="dil_seviyesi">Yabancƒ± Dil Seviyesi:</label>
                            <select id="dil_seviyesi" name="dil_seviyesi" class="matas-form-control">
                                <option value="yok">Yok</option>
                                <option value="a">A Seviyesi (90-100)</option>
                                <option value="b">B Seviyesi (80-89)</option>
                                <option value="c">C Seviyesi (70-79)</option>
                            </select>
                            <span class="matas-tooltip" data-tip="Yabancƒ± dil sƒ±nav sonucunuz varsa, seviyesini se√ßiniz. Dil tazminatƒ± almak i√ßin YDS veya dengi bir sƒ±navdan ge√ßerli puanƒ±nƒ±z olmalƒ±dƒ±r.">?</span>
                        </div>
                        
                        <div class="matas-form-group" id="dil_kullanimi_group" style="display:none;">
                            <label for="dil_kullanimi">Dil Bilgisi Kullanƒ±mƒ±:</label>
                            <select id="dil_kullanimi" name="dil_kullanimi" class="matas-form-control">
                                <option value="hayir">Kullanmƒ±yorum</option>
                                <option value="evet">Kullanƒ±yorum</option>
                            </select>
                            <span class="matas-tooltip" data-tip="G√∂revinizde yabancƒ± dil bilgisini kullanƒ±yorsanƒ±z daha y√ºksek dil tazminatƒ± alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ek √ñdemeler ve Tazminatlar B√∂l√ºm√º -->
            <div class="matas-form-section">
                <div class="matas-form-section-header">
                    <span>Ek √ñdemeler ve Tazminatlar</span>
                    <button type="button" class="matas-form-section-toggle">-</button>
                </div>
                <div class="matas-form-section-content">
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="gorev_tazminati" name="gorev_tazminati" value="1">
                                Eƒüitim-√ñƒüretim Tazminatƒ±
                            </label>
                            <span class="matas-tooltip" data-tip="Eƒüitim-√∂ƒüretim kurumlarƒ±nda √ßalƒ±≈üanlar i√ßin ek tazminat.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="gelistirme_odenegi" name="gelistirme_odenegi" value="1">
                                Geli≈ütirme √ñdeneƒüi
                            </label>
                            <span class="matas-tooltip" data-tip="Geli≈ümekte olan b√∂lgelerdeki kurumlar i√ßin ek √∂denek.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="asgari_gecim_indirimi" name="asgari_gecim_indirimi" value="1" checked>
                                Asgari Ge√ßim ƒ∞ndirimi
                            </label>
                            <span class="matas-tooltip" data-tip="Asgari ge√ßim indirimi, gelir vergisi matrahƒ±ndan d√º≈ü√ºlen bir indirimdir.">?</span>
                        </div>
                    </div>
                    
                    <div class="matas-form-row">
                        <div class="matas-form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="kira_yardimi" name="kira_yardimi" value="1">
                                Kira Yardƒ±mƒ±
                            </label>
                            <span class="matas-tooltip" data-tip="Lojmanda oturmayan ve belirli ≈üartlarƒ± saƒülayan memurlar i√ßin kira yardƒ±mƒ±.">?</span>
                        </div>
                        
                        <div class="matas-form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="sendika_uyesi" name="sendika_uyesi" value="1">
                                Sendika √úyesi
                            </label>
                            <span class="matas-tooltip" data-tip="Sendika √ºyesi iseniz toplu s√∂zle≈üme ikramiyesi alƒ±rsƒ±nƒ±z.">?</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="matas-actions">
                <button type="button" id="matas-hesapla-btn" class="matas-btn matas-btn-primary matas-btn-large">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                        <line x1="8" y1="21" x2="16" y2="21"></line>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                    </svg>
                    Maa≈ü Hesapla
                </button>
                
                <button type="button" id="matas-temizle-btn" class="matas-btn matas-btn-secondary">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Formu Temizle
                </button>
            </div>
        </form>
        
        <div id="matas-sonuclar" class="matas-result-section" style="display:none;">
            <!-- Hesaplama sonu√ßlarƒ± burada g√∂sterilecek -->
        </div>
    </div>
    
    <!-- Yedekleme Sekmesi -->
    <div id="matas-yedekleme" class="matas-tab-content">
        <div class="matas-card">
            <h2>Form Verilerini Kaydet</h2>
            <p>Doldurduƒüunuz form verilerini yedekleyebilir ve daha sonra geri y√ºkleyebilirsiniz.</p>
            
            <div class="matas-form-row">
                <div class="matas-form-group">
                    <button type="button" id="matas-backup-btn" class="matas-btn matas-btn-primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Formu Kaydet
                    </button>
                    
                    <button type="button" id="matas-restore-btn" class="matas-btn matas-btn-secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4M17 8l-5-5-5 5M12 3v12"></path>
                        </svg>
                        Dosyadan Y√ºkle
                    </button>
                    <input type="file" id="matas-restore-file" style="display:none;" accept=".json">
                </div>
            </div>
        </div>
        
        <div class="matas-card">
            <h2>Kaydedilmi≈ü Form Verileri</h2>
            <div id="matas-backup-list">
                <!-- Yedekler burada listelenecek -->
                <p>Hen√ºz yedek bulunmuyor.</p>
            </div>
        </div>
    </div>
    
    <!-- Bilgilendirme Sekmesi -->
    <div id="matas-bilgi" class="matas-tab-content">
        <div class="matas-card">
            <h2>Maa≈ü Hesaplama Hakkƒ±nda</h2>
            <p>MATAS - Maa≈ü Takip Sistemi, T√ºrkiye'deki memurlarƒ±n maa≈ülarƒ±nƒ± hesaplamak i√ßin geli≈ütirilmi≈ü kapsamlƒ± bir hesaplama aracƒ±dƒ±r. Bu hesaplayƒ±cƒ±, en g√ºncel katsayƒ±lar ve deƒüerler kullanƒ±larak a≈üaƒüƒ±daki bile≈üenleri hesaplar:</p>
            
            <h3>Temel Aylƒ±k Bile≈üenleri</h3>
            <ul>
                <li><strong>Taban Aylƒ±k:</strong> Derece ve kademeye g√∂re belirlenen g√∂sterge puanƒ± ile aylƒ±k katsayƒ±nƒ±n √ßarpƒ±mƒ±.</li>
                <li><strong>Ek G√∂sterge:</strong> Unvana g√∂re belirlenen ek g√∂sterge ile aylƒ±k katsayƒ±nƒ±n √ßarpƒ±mƒ±.</li>
                <li><strong>Kƒ±dem Aylƒ±ƒüƒ±:</strong> Hizmet yƒ±lƒ± (en fazla 25 yƒ±l) √ó 25 √ó aylƒ±k katsayƒ±.</li>
                <li><strong>Yan √ñdeme:</strong> Unvana g√∂re belirlenen yan √∂deme puanƒ± √ó yan √∂deme katsayƒ±sƒ±.</li>
                <li><strong>√ñzel Hizmet Tazminatƒ±:</strong> (G√∂sterge puanƒ± + Ek g√∂sterge) √ó Aylƒ±k katsayƒ± √ó (√ñzel hizmet oranƒ± / 100).</li>
            </ul>
            
            <h3>Ek √ñdemeler ve Tazminatlar</h3>
            <ul>
                <li><strong>Ek √ñdeme (666 KHK):</strong> (Taban aylƒ±k + Ek g√∂sterge) √ó 0.20</li>
                <li><strong>Eƒüitim-√ñƒüretim Tazminatƒ±:</strong> Eƒüitim kurumlarƒ±nda √ßalƒ±≈üanlar i√ßin.</li>
                <li><strong>Yabancƒ± Dil Tazminatƒ±:</strong> Yabancƒ± dil sƒ±navƒ±ndan alƒ±nan puana g√∂re.</li>
                <li><strong>Lisans√ºst√º Eƒüitim Tazminatƒ±:</strong> Y√ºksek lisans i√ßin %5, doktora i√ßin %15.</li>
                <li><strong>Makam/G√∂rev/Temsil Tazminatƒ±:</strong> Belirli √ºst d√ºzey g√∂revliler i√ßin.</li>
            </ul>
            
            <h3>Sosyal Yardƒ±mlar</h3>
            <ul>
                <li><strong>Aile Yardƒ±mƒ±:</strong> E≈üin √ßalƒ±≈ümamasƒ± durumunda √∂denir.</li>
                <li><strong>√áocuk Yardƒ±mƒ±:</strong> Her bir √ßocuk i√ßin √∂denir, 0-6 ya≈ü, engelli veya √∂ƒürenim durumuna g√∂re farklƒ±lƒ±k g√∂sterir.</li>
                <li><strong>Kira Yardƒ±mƒ±:</strong> Belirli ≈üartlarƒ± saƒülayanlar i√ßin.</li>
                <li><strong>Sendika Yardƒ±mƒ±:</strong> Sendika √ºyeleri i√ßin.</li>
            </ul>
            
            <h3>Kesintiler</h3>
            <ul>
                <li><strong>Emekli Keseneƒüi:</strong> %16</li>
                <li><strong>Genel Saƒülƒ±k Sigortasƒ±:</strong> %5</li>
                <li><strong>Gelir Vergisi:</strong> Gelir vergisi matrahƒ±na g√∂re kademeli olarak hesaplanƒ±r.</li>
                <li><strong>Damga Vergisi:</strong> Br√ºt maa≈ü √ó 0.00759</li>
            </ul>
        </div>
    </div>
    
    <footer>
        <p>MATAS - Maa≈ü Takip Sistemi &copy; <?php echo date('Y'); ?></p>
    </footer>
</div>
